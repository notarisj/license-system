<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{base :: layout(~{::body})}">

<body>
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h3 class="card-title mb-4">Generated Licenses</h3>
            <form method="get" class="row g-2 mb-3">
                <div class="col-md-3">
                    <input class="form-control" name="q" th:value="${query}" placeholder="Search" />
                </div>
                <div class="col-md-3">
                    <input class="form-control" name="customer" th:value="${customerFilter}"
                        placeholder="Customer ID" />
                </div>
                <div class="col-md-3">
                    <select class="form-select" name="status">
                        <option value="">All Statuses</option>
                        <option value="Valid" th:selected="${statusFilter=='Valid'}">Valid</option>
                        <option value="Expired" th:selected="${statusFilter=='Expired'}">Expired</option>
                        <option value="Revoked" th:selected="${statusFilter=='Revoked'}">Revoked</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-primary w-100" type="submit">Filter</button>
                </div>
            </form>
            <div class="table-responsive">
                <table class="table table-bordered table-hover table-striped align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Customer</th>
                            <th>UUID</th>
                            <th>Issue Date</th>
                            <th>Expiry Date</th>
                            <th>HW FP</th>
                            <th>Status</th>
                            <th>Usage Limit</th>
                            <th>Metadata</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="row : ${rows}">
                            <td th:text="${row.gl.customerId}"></td>
                            <td style="font-size:.9em;word-break:break-all" th:text="${row.gl.uuid}"></td>
                            <td th:text="${#temporals.format(row.gl.issueDate, 'yyyy-MM-dd')}"></td>
                            <td th:text="${#temporals.format(row.gl.expiryDate, 'yyyy-MM-dd')}"></td>
                            <td>
                                <span th:if="${row.gl.hwFingerprint}"
                                    th:text="${#strings.abbreviate(row.gl.hwFingerprint,10)}"
                                    th:attr="title=${row.gl.hwFingerprint}" data-bs-toggle="tooltip"></span>
                                <span th:if="${row.gl.hwFingerprint==null}">-</span>
                            </td>
                            <td>
                                <span class="badge"
                                    th:classappend="${row.status=='Valid'?' bg-success':row.status=='Expired'?' bg-warning text-dark':row.status=='Revoked'?' bg-danger':' bg-secondary'}"
                                    th:text="${row.status}"></span>
                            </td>
                            <td th:text="${row.gl.usageLimit!=null? row.gl.usageLimit : '-'}"></td>
                            <td>
                                <pre th:if="${row.gl.metadataJson}"
                                    style="font-size:.75em;white-space:pre-wrap;word-break:break-all;background:transparent;border:none;padding:0;margin:0"
                                    th:text="${row.gl.metadataJson}"></pre>
                                <span th:if="${row.gl.metadataJson==null}">-</span>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(rows)}">
                            <td colspan="8" class="text-center">No licenses found.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <nav>
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${page==0?' disabled':''}">
                        <a class="page-link"
                            th:href="@{|/licenses?q=${query}&customer=${customerFilter}&status=${statusFilter}&page=${page-1}|}">Previous</a>
                    </li>
                    <li class="page-item disabled">
                        <span class="page-link" th:text="'Page '+${page+1}+' of '+${totalPages}"></span>
                    </li>
                    <li class="page-item" th:classappend="${page+1>=totalPages?' disabled':''}">
                        <a class="page-link"
                            th:href="@{|/licenses?q=${query}&customer=${customerFilter}&status=${statusFilter}&page=${page+1}|}">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</body>

</html>